<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Mouse Tracker - Enhanced with Sound</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            cursor: none;
            user-select: none;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1001;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(255, 107, 107, 0.5);
            border-color: #ff6b6b;
        }

        .cat-container {
            position: relative;
            transform-origin: center;
            transition: transform 0.2s ease-out;
        }

        .cat {
            width: 300px;
            height: 300px;
            background-image: url('https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80');
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: float 3s ease-in-out infinite;
            border: 4px solid rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .cat::before {
            content: '';
            position: absolute;
            top: -15px;
            left: -15px;
            right: -15px;
            bottom: -15px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
            background-size: 300% 300%;
            animation: gradientMove 4s ease infinite;
            z-index: -1;
            opacity: 0.4;
        }

        .cat::after {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            z-index: -1;
        }

        .eyes {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 45px;
        }

        .eye {
            width: 28px;
            height: 28px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .pupil {
            width: 14px;
            height: 14px;
            background: #000;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s ease-out;
        }

        .pupil::after {
            content: '';
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
        }

        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ff6b6b, #ff5252);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
            animation: pulse 1.5s ease-in-out infinite;
        }

        .custom-cursor.clicking {
            transform: translate(-50%, -50%) scale(1.5);
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.8);
        }

        .title {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        .instructions {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .cat-counter {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .collision-info {
            position: absolute;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .sound-indicator {
            position: absolute;
            top: 180px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .sparkles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            animation: sparkleFloat 3s linear infinite;
        }

        .popup-cat {
            position: fixed;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            pointer-events: none;
            z-index: 999;
            border: 3px solid white;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .spawned-cat {
            position: absolute;
            width: 120px;
            height: 120px;
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.8);
            animation: spawnIn 0.3s ease-out;
            transform-origin: center;
            will-change: transform;
            transition: border-color 0.1s ease;
        }

        .spawned-cat.collision {
            border-color: #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.6), 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .spawned-cat::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
            background-size: 300% 300%;
            animation: gradientMove 4s ease infinite;
            z-index: -1;
            opacity: 0.3;
        }

        .spawned-cat .eyes {
            top: 28%;
            gap: 22px;
        }

        .spawned-cat .eye {
            width: 16px;
            height: 16px;
        }

        .spawned-cat .pupil {
            width: 8px;
            height: 8px;
        }

        .spawned-cat .pupil::after {
            width: 2px;
            height: 2px;
        }

        /* Different eye positions for different cat images */
        .spawned-cat[data-cat-type="0"] .eyes { top: 32%; gap: 18px; }
        .spawned-cat[data-cat-type="1"] .eyes { top: 25%; gap: 24px; }
        .spawned-cat[data-cat-type="2"] .eyes { top: 30%; gap: 20px; }
        .spawned-cat[data-cat-type="3"] .eyes { top: 28%; gap: 22px; }
        .spawned-cat[data-cat-type="4"] .eyes { top: 26%; gap: 19px; }
        .spawned-cat[data-cat-type="5"] .eyes { top: 29%; gap: 21px; }
        .spawned-cat[data-cat-type="6"] .eyes { top: 27%; gap: 23px; }

        .sound-wave {
            position: absolute;
            border: 2px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: soundWave 0.6s ease-out forwards;
            pointer-events: none;
            z-index: 998;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), 0 0 20px rgba(255, 255, 255, 0.3); }
            100% { text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), 0 0 30px rgba(255, 255, 255, 0.6); }
        }

        @keyframes sparkleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-10px) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes spawnIn {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.1) rotate(5deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.8);
            }
        }

        @keyframes collisionFlash {
            0%, 100% { 
                border-color: rgba(255, 255, 255, 0.8);
                box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            }
            50% { 
                border-color: #ff6b6b;
                box-shadow: 0 0 20px rgba(255, 107, 107, 0.8), 0 15px 30px rgba(0, 0, 0, 0.3);
            }
        }

        @keyframes soundWave {
            0% {
                width: 0;
                height: 0;
                opacity: 0.8;
            }
            100% {
                width: 100px;
                height: 100px;
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .cat {
                width: 250px;
                height: 250px;
            }
            
            .title {
                font-size: 2rem;
                top: 30px;
            }
            
            .eyes {
                gap: 38px;
            }

            .spawned-cat {
                width: 100px;
                height: 100px;
            }

            .instructions {
                font-size: 0.9rem;
                bottom: 20px;
            }

            .cat-counter {
                font-size: 1rem;
                top: 100px;
            }

            .collision-info {
                font-size: 0.8rem;
                top: 125px;
            }

            .sound-indicator {
                font-size: 0.7rem;
                top: 145px;
            }

            .controls {
                top: 10px;
                right: 10px;
            }

            .control-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Audio elements -->
    <audio id="clickSound" preload="auto">
        <source src="./sounds/man.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div class="custom-cursor" id="cursor"></div>
    
    <div class="controls">
        <button class="control-btn" id="muteBtn" title="Toggle Sound">🔊</button>
        <button class="control-btn" id="clearBtn" title="Clear All Cats">🧹</button>
        <button class="control-btn" id="pauseBtn" title="Pause/Resume">⏸️</button>
    </div>
    
    <div class="title">🐱 Follow My Gaze 🐱</div>
    
    <div class="cat-counter" id="catCounter">Bouncing Cats: 0 / 200</div>
    <div class="collision-info" id="collisionInfo">Collisions: 0</div>
    <div class="sound-indicator" id="soundIndicator">🔊 Sound: ON | Volume: <span id="volumeLevel">50%</span></div>
    
    <div class="instructions">
        Left Click: Spawn fast cats | Right Click: Add bouncing marble cats | Space: Clear | M: Mute
    </div>
    
    <div class="sparkles" id="sparkles"></div>
    
    <div class="container">
        <div class="cat-container" id="catContainer">
            <div class="cat" id="cat">
                <div class="eyes">
                    <div class="eye">
                        <div class="pupil" id="leftPupil"></div>
                    </div>
                    <div class="eye">
                        <div class="pupil" id="rightPupil"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            mouseX: window.innerWidth / 2,
            mouseY: window.innerHeight / 2,
            spawnedCats: [],
            animationId: null,
            totalCollisions: 0,
            isPaused: false,
            isMuted: false,
            volume: 0.5
        };

        // DOM Elements
        const elements = {
            cursor: document.getElementById('cursor'),
            cat: document.getElementById('cat'),
            catContainer: document.getElementById('catContainer'),
            leftPupil: document.getElementById('leftPupil'),
            rightPupil: document.getElementById('rightPupil'),
            sparklesContainer: document.getElementById('sparkles'),
            catCounter: document.getElementById('catCounter'),
            collisionInfo: document.getElementById('collisionInfo'),
            soundIndicator: document.getElementById('soundIndicator'),
            volumeLevel: document.getElementById('volumeLevel'),
            clickSound: document.getElementById('clickSound'),
            muteBtn: document.getElementById('muteBtn'),
            clearBtn: document.getElementById('clearBtn'),
            pauseBtn: document.getElementById('pauseBtn')
        };

        // Cat images for variety
        const catImages = [
            'https://images.unsplash.com/photo-1574158622682-e40e69881006?ixlib=rb-4.0.3&w=400&q=80',
            'https://images.unsplash.com/photo-1513245543132-31f507417b26?ixlib=rb-4.0.3&w=400&q=80',
            'https://images.unsplash.com/photo-1583337130417-3346a1be7dee?ixlib=rb-4.0.3&w=400&q=80',
            'https://images.unsplash.com/photo-1571566882372-1598d88abd90?ixlib=rb-4.0.3&w=400&q=80',
            'https://images.unsplash.com/photo-1592194996308-7b43878e84a6?ixlib=rb-4.0.3&w=400&q=80',
            'https://images.unsplash.com/photo-1606214174585-fe31582dc6ee?ixlib=rb-4.0.3&w=400&q=80',
            'https://images.unsplash.com/photo-1595433707802-6b2626ef1c91?ixlib=rb-4.0.3&w=400&q=80'
        ];

        // Audio Manager
        class AudioManager {
            constructor() {
                this.setupAudio();
            }

            setupAudio() {
                elements.clickSound.volume = gameState.volume;
                elements.clickSound.addEventListener('error', (e) => {
                    console.warn('Audio file not found or failed to load:', e);
                    this.showAudioError();
                });
            }

            playClickSound() {
                if (!gameState.isMuted) {
                    try {
                        elements.clickSound.currentTime = 0;
                        elements.clickSound.play().catch(e => {
                            console.warn('Audio playback failed:', e);
                        });
                    } catch (e) {
                        console.warn('Audio error:', e);
                    }
                }
            }

            setVolume(volume) {
                gameState.volume = Math.max(0, Math.min(1, volume));
                elements.clickSound.volume = gameState.volume;
                this.updateVolumeDisplay();
            }

            toggleMute() {
                gameState.isMuted = !gameState.isMuted;
                this.updateSoundIndicator();
                elements.muteBtn.textContent = gameState.isMuted ? '🔇' : '🔊';
                elements.muteBtn.classList.toggle('active', gameState.isMuted);
            }

            updateVolumeDisplay() {
                elements.volumeLevel.textContent = Math.round(gameState.volume * 100) + '%';
            }

            updateSoundIndicator() {
                const status = gameState.isMuted ? 'OFF' : 'ON';
                const icon = gameState.isMuted ? '🔇' : '🔊';
                elements.soundIndicator.innerHTML = `${icon} Sound: ${status} | Volume: <span id="volumeLevel">${Math.round(gameState.volume * 100)}%</span>`;
                elements.volumeLevel = document.getElementById('volumeLevel');
            }

            showAudioError() {
                elements.soundIndicator.innerHTML = '⚠️ Audio file not found | Place man.mp3 in ./sounds/ folder';
                elements.soundIndicator.style.color = 'rgba(255, 200, 200, 0.8)';
            }
        }

        // Visual Effects Manager
        class EffectsManager {
            static createSoundWave(x, y) {
                const wave = document.createElement('div');
                wave.className = 'sound-wave';
                wave.style.left = (x - 50) + 'px';
                wave.style.top = (y - 50) + 'px';
                document.body.appendChild(wave);

                setTimeout(() => {
                    if (wave.parentNode) {
                        wave.parentNode.removeChild(wave);
                    }
                }, 600);
            }

            static addClickEffect() {
                elements.cursor.classList.add('clicking');
                setTimeout(() => {
                    elements.cursor.classList.remove('clicking');
                }, 150);
            }

            static createSparkle() {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 3 + 's';
                sparkle.style.animationDuration = (Math.random() * 3 + 2) + 's';
                elements.sparklesContainer.appendChild(sparkle);

                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 5000);
            }
        }

        // Cat Eye Tracking
        class EyeTracker {
            static updateCatGaze() {
                const catRect = elements.cat.getBoundingClientRect();
                const catCenterX = catRect.left + catRect.width / 2;
                const catCenterY = catRect.top + catRect.height / 2;

                const leftEyeX = catCenterX - 22;
                const leftEyeY = catCenterY - 45;
                const rightEyeX = catCenterX + 22;
                const rightEyeY = catCenterY - 45;

                this.updatePupil(elements.leftPupil, leftEyeX, leftEyeY);
                this.updatePupil(elements.rightPupil, rightEyeX, rightEyeY);
            }

            static updatePupil(pupil, eyeX, eyeY, maxDistance = 7) {
                const deltaX = gameState.mouseX - eyeX;
                const deltaY = gameState.mouseY - eyeY;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                
                const limitedDistance = Math.min(distance, maxDistance);
                const angle = Math.atan2(deltaY, deltaX);
                
                const pupilX = Math.cos(angle) * limitedDistance;
                const pupilY = Math.sin(angle) * limitedDistance;
                
                pupil.style.transform = `translate(calc(-50% + ${pupilX}px), calc(-50% + ${pupilY}px))`;
            }

            static updateCatRotation() {
                const catRect = elements.cat.getBoundingClientRect();
                const catCenterX = catRect.left + catRect.width / 2;
                const catCenterY = catRect.top + catRect.height / 2;
                
                const deltaX = gameState.mouseX - catCenterX;
                const deltaY = gameState.mouseY - catCenterY;
                const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
                
                const limitedAngle = Math.max(-15, Math.min(15, angle * 0.1));
                elements.catContainer.style.transform = `rotate(${limitedAngle}deg)`;
            }
        }

        // Cat Spawning and Management
        class CatManager {
            static createPopupCats(clickX, clickY) {
                const numCats = Math.floor(Math.random() * 3) + 1;
                
                for (let i = 0; i < numCats; i++) {
                    const popupCat = document.createElement('div');
                    popupCat.className = 'popup-cat';
                    
                    const randomImage = catImages[Math.floor(Math.random() * catImages.length)];
                    popupCat.style.backgroundImage = `url('${randomImage}')`;
                    
                    const angle = Math.random() * 2 * Math.PI;
                    const distance = 150 + Math.random() * 250;
                    const bounceX = Math.cos(angle) * distance;
                    const bounceY = Math.sin(angle) * distance;
                    
                    popupCat.style.left = clickX + 'px';
                    popupCat.style.top = clickY + 'px';
                    
                    const keyframeName = `bounceOut${Date.now()}${i}`;
                    const keyframes = `
                        @keyframes ${keyframeName} {
                            0% {
                                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                                opacity: 1;
                            }
                            10% {
                                transform: translate(-50%, -50%) scale(1.4) rotate(20deg);
                                opacity: 1;
                            }
                            25% {
                                transform: translate(calc(-50% + ${bounceX * 0.4}px), calc(-50% + ${bounceY * 0.4}px)) scale(1.2) rotate(-15deg);
                                opacity: 1;
                            }
                            50% {
                                transform: translate(calc(-50% + ${bounceX * 0.8}px), calc(-50% + ${bounceY * 0.8}px)) scale(1) rotate(10deg);
                                opacity: 0.9;
                            }
                            100% {
                                transform: translate(calc(-50% + ${bounceX}px), calc(-50% + ${bounceY}px)) scale(0.4) rotate(0deg);
                                opacity: 0;
                            }
                        }
                    `;
                    
                    const style = document.createElement('style');
                    style.textContent = keyframes;
                    document.head.appendChild(style);
                    
                    popupCat.style.animation = `${keyframeName} 0.8s ease-out forwards`;
                    popupCat.style.animationDelay = (i * 0.05) + 's';
                    
                    document.body.appendChild(popupCat);
                    
                    setTimeout(() => {
                        if (popupCat.parentNode) {
                            popupCat.parentNode.removeChild(popupCat);
                        }
                        if (style.parentNode) {
                            style.parentNode.removeChild(style);
                        }
                    }, 800 + (i * 50));
                }
            }

            static spawnTrackingCat(clickX, clickY) {
                if (gameState.spawnedCats.length >= 200) return;
                
                const spawnedCat = document.createElement('div');
                spawnedCat.className = 'spawned-cat';
                
                const catType = Math.floor(Math.random() * catImages.length);
                const randomImage = catImages[catType];
                spawnedCat.style.backgroundImage = `url('${randomImage}')`;
                spawnedCat.setAttribute('data-cat-type', catType);
                
                const catSize = 120;
                const x = Math.max(catSize/2, Math.min(window.innerWidth - catSize/2, clickX));
                const y = Math.max(catSize/2, Math.min(window.innerHeight - catSize/2, clickY));
                
                const speed = 2 + Math.random() * 4;
                const angle = Math.random() * 2 * Math.PI;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                
                const eyesContainer = document.createElement('div');
                eyesContainer.className = 'eyes';
                
                const leftEye = document.createElement('div');
                leftEye.className = 'eye';
                const leftPupil = document.createElement('div');
                leftPupil.className = 'pupil';
                leftEye.appendChild(leftPupil);
                
                const rightEye = document.createElement('div');
                rightEye.className = 'eye';
                const rightPupil = document.createElement('div');
                rightPupil.className = 'pupil';
                rightEye.appendChild(rightPupil);
                
                eyesContainer.appendChild(leftEye);
                eyesContainer.appendChild(rightEye);
                spawnedCat.appendChild(eyesContainer);
                
                document.body.appendChild(spawnedCat);
                
                const catData = {
                    element: spawnedCat,
                    leftPupil: leftPupil,
                    rightPupil: rightPupil,
                    x: x,
                    y: y,
                    vx: vx,
                    vy: vy,
                    catType: catType,
                    birthTime: Date.now()
                };
                
                gameState.spawnedCats.push(catData);
                this.updateCatCounter();
                
                setTimeout(() => {
                    this.removeCat(catData);
                }, 30000);
            }

            static removeCat(catData) {
                const index = gameState.spawnedCats.indexOf(catData);
                if (index > -1) {
                    catData.element.style.animation = 'fadeOut 0.5s ease-out forwards';
                    
                    setTimeout(() => {
                        gameState.spawnedCats.splice(index, 1);
                        if (catData.element.parentNode) {
                            catData.element.parentNode.removeChild(catData.element);
                        }
                        this.updateCatCounter();
                    }, 500);
                }
            }

            static clearAllCats() {
                gameState.spawnedCats.forEach(catData => {
                    if (catData.element.parentNode) {
                        catData.element.parentNode.removeChild(catData.element);
                    }
                });
                gameState.spawnedCats = [];
                gameState.totalCollisions = 0;
                this.updateCatCounter();
                this.updateCollisionCounter();
            }

            static updateCatCounter() {
                elements.catCounter.textContent = `Bouncing Cats: ${gameState.spawnedCats.length} / 200`;
            }

            static updateCollisionCounter() {
                elements.collisionInfo.textContent = `Collisions: ${gameState.totalCollisions}`;
            }

            static getEyeOffset(catType) {
                const offsets = [
                    { gapX: 9, offsetY: 20 },
                    { gapX: 12, offsetY: 30 },
                    { gapX: 10, offsetY: 25 },
                    { gapX: 11, offsetY: 22 },
                    { gapX: 9.5, offsetY: 27 },
                    { gapX: 10.5, offsetY: 23 },
                    { gapX: 11.5, offsetY: 24 }
                ];
                return offsets[catType] || offsets[0];
            }
        }

        // Physics Engine
        class PhysicsEngine {
            static checkCollision(cat1, cat2) {
                const dx = cat1.x - cat2.x;
                const dy = cat1.y - cat2.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const minDistance = 60;
                
                return distance < minDistance;
            }

            static resolveCollision(cat1, cat2) {
                const dx = cat2.x - cat1.x;
                const dy = cat2.y - cat1.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance === 0) return;
                
                const nx = dx / distance;
                const ny = dy / distance;
                
                const overlap = 60 - distance;
                if (overlap > 0) {
                    const separationX = (overlap / 2) * nx;
                    const separationY = (overlap / 2) * ny;
                    
                    cat1.x -= separationX;
                    cat1.y -= separationY;
                    cat2.x += separationX;
                    cat2.y += separationY;
                }
                
                const dvx = cat2.vx - cat1.vx;
                const dvy = cat2.vy - cat1.vy;
                const dvn = dvx * nx + dvy * ny;
                
                if (dvn > 0) return;
                
                const restitution = 0.8;
                const impulse = 2 * dvn / 2;
                
                cat1.vx += impulse * nx * restitution;
                cat1.vy += impulse * ny * restitution;
                cat2.vx -= impulse * nx * restitution;
                cat2.vy -= impulse * ny * restitution;
                
                cat1.element.style.animation = 'collisionFlash 0.3s ease-out';
                cat2.element.style.animation = 'collisionFlash 0.3s ease-out';
                
                setTimeout(() => {
                    cat1.element.style.animation = '';
                    cat2.element.style.animation = '';
                }, 300);
                
                gameState.totalCollisions++;
                CatManager.updateCollisionCounter();
            }

            static handleCollisions() {
                for (let i = 0; i < gameState.spawnedCats.length; i++) {
                    for (let j = i + 1; j < gameState.spawnedCats.length; j++) {
                        if (this.checkCollision(gameState.spawnedCats[i], gameState.spawnedCats[j])) {
                            this.resolveCollision(gameState.spawnedCats[i], gameState.spawnedCats[j]);
                        }
                    }
                }
            }
        }

        // Game Controller
        class GameController {
            constructor() {
                this.audioManager = new AudioManager();
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initializeCursor();
                this.startSparkles();
                this.startAnimation();
                EyeTracker.updateCatGaze();
                EyeTracker.updateCatRotation();
            }

            setupEventListeners() {
                // Disable context menu
                document.addEventListener('contextmenu', (e) => e.preventDefault());

                // Mouse movement
                document.addEventListener('mousemove', (e) => {
                    gameState.mouseX = e.clientX;
                    gameState.mouseY = e.clientY;
                    
                    elements.cursor.style.left = gameState.mouseX + 'px';
                    elements.cursor.style.top = gameState.mouseY + 'px';
                    
                    if (!gameState.isPaused) {
                        EyeTracker.updateCatGaze();
                        EyeTracker.updateCatRotation();
                    }
                });

                // Mouse clicks
                document.addEventListener('click', (e) => {
                    if (e.button === 0 && !gameState.isPaused) {
                        this.handleLeftClick(e.clientX, e.clientY);
                    }
                });

                document.addEventListener('mousedown', (e) => {
                    if (e.button === 2 && !gameState.isPaused) {
                        e.preventDefault();
                        this.handleRightClick(e.clientX, e.clientY);
                    }
                });

                // Touch support for mobile
                document.addEventListener('touchstart', (e) => {
                    if (!gameState.isPaused) {
                        const touch = e.touches[0];
                        this.handleLeftClick(touch.clientX, touch.clientY);
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.key.toLowerCase()) {
                        case ' ':
                            e.preventDefault();
                            CatManager.clearAllCats();
                            break;
                        case 'm':
                            this.audioManager.toggleMute();
                            break;
                        case 'p':
                            this.togglePause();
                            break;
                        case 'arrowup':
                            e.preventDefault();
                            this.audioManager.setVolume(gameState.volume + 0.1);
                            break;
                        case 'arrowdown':
                            e.preventDefault();
                            this.audioManager.setVolume(gameState.volume - 0.1);
                            break;
                    }
                });

                // Control buttons
                elements.muteBtn.addEventListener('click', () => {
                    this.audioManager.toggleMute();
                });

                elements.clearBtn.addEventListener('click', () => {
                    CatManager.clearAllCats();
                });

                elements.pauseBtn.addEventListener('click', () => {
                    this.togglePause();
                });

                // Window resize
                window.addEventListener('resize', () => {
                    if (!gameState.isPaused) {
                        EyeTracker.updateCatGaze();
                        EyeTracker.updateCatRotation();
                    }
                });

                // Cursor visibility
                document.addEventListener('mouseenter', () => {
                    elements.cursor.style.display = 'block';
                });

                document.addEventListener('mouseleave', () => {
                    elements.cursor.style.display = 'none';
                });
            }

            handleLeftClick(x, y) {
                EffectsManager.addClickEffect();
                EffectsManager.createSoundWave(x, y);
                this.audioManager.playClickSound();
                CatManager.createPopupCats(x, y);
            }

            handleRightClick(x, y) {
                EffectsManager.addClickEffect();
                EffectsManager.createSoundWave(x, y);
                this.audioManager.playClickSound();
                CatManager.spawnTrackingCat(x, y);
            }

            togglePause() {
                gameState.isPaused = !gameState.isPaused;
                elements.pauseBtn.textContent = gameState.isPaused ? '▶️' : '⏸️';
                elements.pauseBtn.classList.toggle('active', gameState.isPaused);
                
                if (!gameState.isPaused) {
                    this.startAnimation();
                } else if (gameState.animationId) {
                    cancelAnimationFrame(gameState.animationId);
                }
            }

            initializeCursor() {
                elements.cursor.style.left = gameState.mouseX + 'px';
                elements.cursor.style.top = gameState.mouseY + 'px';
            }

            startSparkles() {
                setInterval(() => {
                    EffectsManager.createSparkle();
                }, 500);
            }

            startAnimation() {
                const animate = () => {
                    if (gameState.isPaused) return;

                    PhysicsEngine.handleCollisions();
                    
                    gameState.spawnedCats.forEach(catData => {
                        const catElement = catData.element;
                        
                        catData.x += catData.vx;
                        catData.y += catData.vy;
                        
                        const catSize = 120;
                        if (catData.x <= catSize/2) {
                            catData.x = catSize/2;
                            catData.vx = Math.abs(catData.vx);
                        }
                        if (catData.x >= window.innerWidth - catSize/2) {
                            catData.x = window.innerWidth - catSize/2;
                            catData.vx = -Math.abs(catData.vx);
                        }
                        if (catData.y <= catSize/2) {
                            catData.y = catSize/2;
                            catData.vy = Math.abs(catData.vy);
                        }
                        if (catData.y >= window.innerHeight - catSize/2) {
                            catData.y = window.innerHeight - catSize/2;
                            catData.vy = -Math.abs(catData.vy);
                        }
                        
                        catElement.style.left = (catData.x - catSize/2) + 'px';
                        catElement.style.top = (catData.y - catSize/2) + 'px';
                        
                        const catRect = catElement.getBoundingClientRect();
                        const catCenterX = catRect.left + catRect.width / 2;
                        const catCenterY = catRect.top + catRect.height / 2;

                        const eyeOffset = CatManager.getEyeOffset(catData.catType);
                        const leftEyeX = catCenterX - eyeOffset.gapX;
                        const leftEyeY = catCenterY - eyeOffset.offsetY;
                        const rightEyeX = catCenterX + eyeOffset.gapX;
                        const rightEyeY = catCenterY - eyeOffset.offsetY;

                        EyeTracker.updatePupil(catData.leftPupil, leftEyeX, leftEyeY, 3);
                        EyeTracker.updatePupil(catData.rightPupil, rightEyeX, rightEyeY, 3);
                    });
                    
                    gameState.animationId = requestAnimationFrame(animate);
                };
                
                animate();
            }
        }

        // Initialize the game when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new GameController();
        });

        // Start immediately if DOM is already loaded
        if (document.readyState === 'loading') {
            // Still loading, wait for DOMContentLoaded
        } else {
            // DOM is already loaded
            new GameController();
        }
    </script>
</body>
</html>